class Component{constructor(){this.rootElement,this.eventListeners=[]}setElement(e){this.rootElement=e}inflate(e,t){}deflate(){this.rootElement&&this.rootElement.parentElement&&(this.removeEventListeners(),this.rootElement.parentElement.removeChild(this.rootElement))}addEventListener(e,t,i){this.isElement(e)&&(e.addEventListener(t,i),this.eventListeners.push({el:e,type:t,listener:i}))}removeEventListeners(){let e,t;for(e=0;e<this.eventListeners.length;e++)(t=this.eventListeners[e]).el.removeEventListener(t.type,t.listener)}empty(e){if(this.isElement(e))for(;e.firstChild;)e.removeChild(e.firstChild)}isElement(e){return e instanceof Element||e instanceof HTMLDocument}proper(e){return e.charAt(0).toUpperCase()+e.slice(1)}capitalize(e){const t=e.split(" ");for(let e=0;e<t.length;e++)t[e]=this.proper(t[e]);return t.join(" ")}httpGet(e,t){const i=new XMLHttpRequest;i.open("GET",e,!0),i.setRequestHeader("Zotero-API-Key","GGqHsVvuFtE8TdggbBvqTj1r"),i.onload=function(){i.readyState===XMLHttpRequest.DONE&&i.status>=200&&i.status<400&&t(i)},i.send()}}class CitationList extends Component{constructor(e){super(),this.bibliography=e,this.listElement,this.items=[]}inflate(e,t){if(e&&t){const i=this.bibliography.sortVariable;let n,o,l,s,a,d;const h=document.createDocumentFragment();for(this.rootElement=document.createElement("div"),n=0;n<t.length;n++)o=new Citation(this,t[n].data),l=null,"creator"==i?o.authors&&o.authors.length>0&&(l=o.authors[0].lastName[0]):"title"==i?o.title&&(l=o.title[0]):"itemType"==i?o.itemType&&this.bibliography.itemTypes.hasOwnProperty(o.itemType)&&(l=this.bibliography.itemTypes[o.itemType]):"date"==i&&o.year&&(l=o.year),l&&l!=s&&((a=document.createElement("div")).className="bib-list-separator",a.appendChild(document.createTextNode(l)),this.rootElement.appendChild(a),(d=document.createElement("ol")).className="bib-citation-list",this.rootElement.appendChild(d),s=l),o.inflate(d),this.items.push(o);h.appendChild(this.rootElement),e.appendChild(h)}}deflate(){this.deflateContent(),this.items=[],super.deflate()}deflateContent(){if(this.rootElement){let e,t;for(e=0;e<this.items.length;e++)(t=this.items[e]).deflate()}}inflatePlaceholders(e,t){if(e){let i,n;const o=document.createDocumentFragment();this.rootElement=document.createElement("div");const l=document.createElement("div");l.className="bib-list-separator-placeholder load-placeholder",this.rootElement.appendChild(l);const s=document.createElement("ol");s.className="bib-citation-list";for(let e=0;e<t;e++)(i=document.createElement("div")).className="bib-citation",(n=document.createElement("div")).className="bib-citation-placeholder load-placeholder",i.appendChild(n),(n=document.createElement("div")).className="bib-citation-placeholder load-placeholder",i.appendChild(n),(n=document.createElement("div")).className="bib-citation-placeholder load-placeholder",i.appendChild(n),s.appendChild(i);this.rootElement.appendChild(s),o.appendChild(this.rootElement),e.appendChild(o)}}search(e){this.bibliography.search(e)}searchKeywords(e){this.bibliography.searchKeywords(e)}onSelection(e){this.bibliography.onSelection(e)}}class Citation extends Component{constructor(e,t){let i,n,o,l,s,a;super(),this.list=e,this.key=t.key,this.titleElement,this.title,this.itemType,this.year,this.authors=[];for(let e in t)t.hasOwnProperty(e)&&(this[e]=t[e]);if(t.date){for(i=this.date.split(" "),n=0;n<i.length;n++)if(!isNaN(i[n])&&4==i[n].length){this.year=i[n];break}this.year||(i=this.date.split("/"),this.year=i[i.length-1])}if(t.creators)for(n=0;n<t.creators.length;n++)l=(o=t.creators[n]).lastName,o.firstName?(i=o.firstName.split(" ")).length>1?(s=i[0].trim().substring(0,1),a=i[1].trim().substring(0,1),l=o.lastName+" "+s+a):i.length>0&&(s=i[0].trim().substring(0,1),l=o.lastName+" "+s):o.fullName&&(l=o.fullName),this.authors.push({fullName:l,lastName:o.lastName})}inflate(e){const t=this,i=this.list.bibliography.isSimple;if(e){let n,o,l,s,a;const d=document.createDocumentFragment();if(this.rootElement=document.createElement("li"),this.rootElement.className="bib-citation",this.authors.length>0)if(i){for(a=document.createElement("span"),n=0;n<this.authors.length;n++)if(l=(o=this.authors[n]).fullName,n<this.authors.length-1&&(l+=", "),a.appendChild(document.createTextNode(l)),9==n){a.appendChild(document.createTextNode("et al"));break}this.rootElement.appendChild(a)}else for(n=0;n<this.authors.length;n++)if(l=(o=this.authors[n]).fullName,s=o.lastName,n<this.authors.length-1&&(l+=", "),(a=document.createElement("a")).href="#",a.appendChild(document.createTextNode(l)),this.rootElement.appendChild(a),this.addAuthorEventListeners(a,s),9==n){(a=document.createElement("span")).appendChild(document.createTextNode("et al")),this.rootElement.appendChild(a);break}if(this.year&&(this.rootElement.appendChild(document.createTextNode(". ")),(a=document.createElement("span")).appendChild(document.createTextNode(this.year)),this.rootElement.appendChild(a)),this.title&&(this.rootElement.appendChild(document.createTextNode(". ")),this.titleElement=document.createElement("a"),this.titleElement.href="#",this.titleElement.className="bib-citation-title",this.italicize(this.titleElement,this.title),this.rootElement.appendChild(this.titleElement),this.addEventListener(this.titleElement,"click",function(e){e.preventDefault(),t.onSelection()}),this.addEventListener(this.titleElement,"keydown",function(e){13==e.keyCode&&(e.preventDefault(),t.onSelection())})),"book"==this.itemType)this.publisher&&(this.rootElement.appendChild(document.createTextNode(". ")),(a=document.createElement("span")).appendChild(document.createTextNode(this.publisher)),this.rootElement.appendChild(a)),this.place&&(this.rootElement.appendChild(document.createTextNode(". ")),(a=document.createElement("span")).appendChild(document.createTextNode(this.place)),this.rootElement.appendChild(a)),this.numPages&&(this.rootElement.appendChild(document.createTextNode(". ")),(a=document.createElement("span")).appendChild(document.createTextNode(this.numPages+"pp")),this.rootElement.appendChild(a));else if("bookSection"==this.itemType)this.bookTitle&&(this.rootElement.appendChild(document.createTextNode(". ")),(a=document.createElement("span")).appendChild(document.createTextNode(this.bookTitle)),this.rootElement.appendChild(a)),this.publisher&&(this.rootElement.appendChild(document.createTextNode(". ")),(a=document.createElement("span")).appendChild(document.createTextNode(this.publisher)),this.rootElement.appendChild(a)),this.place&&(this.rootElement.appendChild(document.createTextNode(". ")),(a=document.createElement("span")).appendChild(document.createTextNode(this.place)),this.rootElement.appendChild(a)),this.pages&&(this.rootElement.appendChild(document.createTextNode(". ")),(a=document.createElement("span")).appendChild(document.createTextNode(this.pages)),this.rootElement.appendChild(a));else{if(this.publicationTitle&&(this.rootElement.appendChild(document.createTextNode(". ")),(a=document.createElement("span")).appendChild(document.createTextNode(this.publicationTitle)),this.rootElement.appendChild(a)),this.proceedingsTitle&&(this.rootElement.appendChild(document.createTextNode(". ")),(a=document.createElement("span")).appendChild(document.createTextNode(this.proceedingsTitle)),this.rootElement.appendChild(a)),this.conferenceName&&(this.rootElement.appendChild(document.createTextNode(". ")),(a=document.createElement("span")).appendChild(document.createTextNode(this.conferenceName)),this.rootElement.appendChild(a)),this.publisher&&(this.rootElement.appendChild(document.createTextNode(". ")),(a=document.createElement("span")).appendChild(document.createTextNode(this.publisher)),this.rootElement.appendChild(a)),this.place&&(this.rootElement.appendChild(document.createTextNode(". ")),(a=document.createElement("span")).appendChild(document.createTextNode(this.place)),this.rootElement.appendChild(a)),this.volume&&(this.rootElement.appendChild(document.createTextNode(". ")),(a=document.createElement("span")).appendChild(document.createTextNode(this.volume)),this.rootElement.appendChild(a)),this.issue&&((a=document.createElement("span")).appendChild(document.createTextNode("("+this.issue+")")),this.rootElement.appendChild(a)),this.pages){let e;e=this.volume||this.issue?":"+this.pages:". "+this.pages,(a=document.createElement("span")).appendChild(document.createTextNode(e)),this.rootElement.appendChild(a)}this.rootElement.appendChild(document.createTextNode("."))}if(this.doi&&((a=document.createElement("a")).href="dx.doi.org/"+this.doi,a.target="_blank",a.appendChild(document.createTextNode(" DOI")),this.rootElement.appendChild(a)),this.title){let e="https://scholar.google.com/scholar?hl=en&q="+this.title;this.authors.length>0&&(e=e+"&as_sauthors="+this.authors[0].fullName),(a=document.createElement("a")).className="highlighted-link",a.href=e,a.target="_blank",a.appendChild(document.createTextNode(" Google Scholar")),this.rootElement.appendChild(a)}a=this.getExportLink("bibtex","BibTeX"),this.rootElement.appendChild(a),a=this.getExportLink("ris","RIS"),this.rootElement.appendChild(a),d.appendChild(this.rootElement),e.appendChild(d)}}addAuthorEventListeners(e,t){const i=this;this.addEventListener(e,"click",function(e){e.preventDefault(),i.search(t)}),this.addEventListener(e,"keydown",function(e){13==e.keyCode&&(e.preventDefault(),i.search(t))})}getExportLink(e,t){const i=this,n=document.createElement("a");return n.className="highlighted-link",n.href="#",n.appendChild(document.createTextNode(" "+t)),this.addEventListener(n,"click",function(t){t.preventDefault(),i.exportCitation(e)}),this.addEventListener(n,"keydown",function(t){13==t.keyCode&&(t.preventDefault(),i.exportCitation(e))}),n}search(e){this.list.search(e)}onSelection(){this.list.onSelection(this)}exportCitation(e){let t,i="https://api.zotero.org/users/10063140/items/"+this.key;"bibtex"==e?(i+="?format=bibtex&v=3",t="citations.bib"):"ris"==e&&(i+="?format=ris&v=3",t="citations.ris"),i&&this.httpGet(i,function(e){const i=document.createElement("a");i.setAttribute("href","data:text;charset=utf-8,"+encodeURIComponent(e.response)),i.setAttribute("download",t),i.style.display="none",document.body.appendChild(i),i.click(),document.body.removeChild(i)})}italicize(e,t){const i=["<i>","</i>"];let n,o,l;if(e&&t){const s=this.splitContent([t],i,0);for(n=0;n<s.length;n++)"<i>"==(o=s[n])?l=document.createElement("i"):"</i>"==o?(e.appendChild(l),l=null):l?l.appendChild(document.createTextNode(o)):e.appendChild(document.createTextNode(o))}}splitContent(e,t,i){let n,o,l,s,a,d,h=[];if(t&&i<t.length)for(o=t[i],i++,n=0;n<e.length;n++){for(l=e[n].split(o),s=[],d=0;d<l.length;d++)s.push(l[d]),d<l.length-1&&s.push(o);for(a=this.splitContent(s,t,i),d=0;d<a.length;d++)a[d]&&h.push(a[d])}else h=e;return h}}class CitationPopup extends Component{constructor(e){super(),this.bibliography=e,this.contentElement,this.closeElement,this.closeFunction}inflate(e){const t=this;if(e){const i=document.createDocumentFragment();this.rootElement=document.createElement("div"),this.rootElement.id="bib-popup-overlay",this.contentElement=document.createElement("div"),this.contentElement.id="bib-popup-content",this.closeElement=document.createElement("div"),this.closeElement.id="bib-popup-close-button",this.closeElement.role="button",this.closeElement.tabIndex=0,this.closeElement.setAttribute("aria-label","Close"),this.closeElement.title="Close",this.contentElement.appendChild(this.closeElement),this.addEventListener(this.closeElement,"click",function(e){t.closePopup()}),this.addEventListener(this.closeElement,"keydown",function(e){13!=e.keyCode&&32!=e.keyCode||t.closePopup()}),this.rootElement.appendChild(this.contentElement),i.appendChild(this.rootElement),e.appendChild(i)}}deflate(){this.citationTable.deflate(),super.deflate()}openPopup(e,t){this.closeFunction=t,this.rootElement.classList.add("active"),this.rootElement.setAttribute("aria-hidden","false"),this.citationTable=new CitationTable(this,e,this.bibliography.itemTypes,this.bibliography.itemFields),this.citationTable.inflate(this.contentElement)}closePopup(){this.rootElement.classList.remove("active"),this.rootElement.setAttribute("aria-hidden","true"),this.closeFunction&&this.closeFunction(),this.citationTable.deflate()}search(e){this.bibliography.search(e),this.closePopup()}searchKeywords(e){this.bibliography.searchKeywords(e),this.closePopup()}}class CitationTable extends Component{constructor(e,t,i,n){super(),this.popup=e,this.citation=t,this.itemTypes=i,this.itemFields=n}inflate(e){const t=this.popup.bibliography.isSimple;if(e&&this.citation){const i=document.createDocumentFragment();this.rootElement=document.createElement("div"),this.rootElement.id="bib-table-container";const n=document.createElement("h1");n.id="bib-table-title",this.italicize(n,this.citation.title),this.rootElement.appendChild(n);const o=document.createElement("table");let l,s,a,d,h,r,c,p,m,u,E,C;o.id="bib-table";for(let e in this.citation)if(this.citation.hasOwnProperty(e))if(l=this.citation[e],"itemType"==e&&this.itemTypes.hasOwnProperty(l))s=this.itemTypes[l],a=document.createElement("tr"),(d=document.createElement("th")).appendChild(document.createTextNode("Publication Type")),a.appendChild(d),(h=document.createElement("td")).appendChild(document.createTextNode(s)),a.appendChild(h),o.appendChild(a);else if("title"==e||"abstractNote"==e)s=this.itemFields[e],l&&(l=(l=l.replaceAll("<p>","")).replaceAll("</p>",""),a=document.createElement("tr"),(d=document.createElement("th")).appendChild(document.createTextNode(s)),a.appendChild(d),h=document.createElement("td"),this.italicize(h,l),a.appendChild(h),o.appendChild(a));else if("authors"==e){if(a=document.createElement("tr"),(d=document.createElement("th")).appendChild(document.createTextNode("Authors")),a.appendChild(d),h=document.createElement("td"),t){for(E=document.createElement("span"),r=0;r<l.length;r++)if(p=(c=l[r]).fullName,r<l.length-1&&(p+=", "),E.appendChild(document.createTextNode(p)),9==r){E.appendChild(document.createTextNode("et al."));break}h.appendChild(E)}else for(r=0;r<l.length;r++)if(p=(c=l[r]).fullName,m=c.lastName,(u=document.createElement("a")).href="#",u.appendChild(document.createTextNode(p)),h.appendChild(u),this.addAuthorEventListeners(u,m),r<l.length-1&&((E=document.createElement("a")).appendChild(document.createTextNode(", ")),h.appendChild(E)),9==r){(u=document.createElement("span")).appendChild(document.createTextNode("et al.")),h.appendChild(u);break}a.appendChild(h),o.appendChild(a)}else if("tags"==e&&l.length>0){if(a=document.createElement("tr"),(d=document.createElement("th")).appendChild(document.createTextNode("Keywords")),a.appendChild(d),h=document.createElement("td"),t){for(E=document.createElement("span"),r=0;r<l.length;r++)C=l[r].tag,r<l.length-1&&(C+=", "),E.appendChild(document.createTextNode(C));h.appendChild(E)}else for(r=0;r<l.length;r++)C=l[r].tag,(u=document.createElement("a")).href="#",u.appendChild(document.createTextNode(C)),h.appendChild(u),this.addTagEventListeners(u,C),r<l.length-1&&((E=document.createElement("a")).appendChild(document.createTextNode(", ")),h.appendChild(E));a.appendChild(h),o.appendChild(a)}else"url"==e?(s=this.itemFields[e],l&&(a=document.createElement("tr"),(d=document.createElement("th")).appendChild(document.createTextNode(s)),a.appendChild(d),h=document.createElement("td"),(u=document.createElement("a")).href=l,u.target="_blank",u.appendChild(document.createTextNode(l)),h.appendChild(u),a.appendChild(h),o.appendChild(a))):this.itemFields.hasOwnProperty(e)&&(s=this.itemFields[e],l&&(a=document.createElement("tr"),(d=document.createElement("th")).appendChild(document.createTextNode(s)),a.appendChild(d),(h=document.createElement("td")).appendChild(document.createTextNode(l)),a.appendChild(h),o.appendChild(a)));this.rootElement.appendChild(o),i.appendChild(this.rootElement),e.appendChild(i)}}addAuthorEventListeners(e,t){const i=this;this.addEventListener(e,"click",function(e){e.preventDefault(),i.search(t)}),this.addEventListener(e,"keydown",function(e){13==e.keyCode&&(e.preventDefault(),i.search(t))})}addTagEventListeners(e,t){const i=this;this.addEventListener(e,"click",function(e){e.preventDefault(),i.searchKeywords(t)}),this.addEventListener(e,"keydown",function(e){13==e.keyCode&&(e.preventDefault(),i.searchKeywords(t))})}search(e){this.popup.search(e)}searchKeywords(e){this.popup.searchKeywords(e)}italicize(e,t){const i=["<i>","</i>"];let n,o,l;if(e&&t){const s=this.splitContent([t],i,0);for(n=0;n<s.length;n++)"<i>"==(o=s[n])?l=document.createElement("i"):"</i>"==o?(e.appendChild(l),l=null):l?l.appendChild(document.createTextNode(o)):e.appendChild(document.createTextNode(o))}}splitContent(e,t,i){let n,o,l,s,a,d,h=[];if(t&&i<t.length)for(o=t[i],i++,n=0;n<e.length;n++){for(l=e[n].split(o),s=[],d=0;d<l.length;d++)s.push(l[d]),d<l.length-1&&s.push(o);for(a=this.splitContent(s,t,i),d=0;d<a.length;d++)a[d]&&h.push(a[d])}else h=e;return h}}class Filter extends Component{constructor(e,t,i){super(),this.bibliography=e,this.type=t,this.label=i}inflate(e){const t=this;if(e){const i=document.createDocumentFragment();this.rootElement=document.createElement("div"),this.rootElement.className="bib-filter",this.rootElement.role="button",this.rootElement.tabIndex=0,this.rootElement.setAttribute("aria-label","Remove filter"),this.rootElement.appendChild(document.createTextNode(this.label)),this.addEventListener(this.rootElement,"click",function(e){e.preventDefault(),t.remove()}),this.addEventListener(this.rootElement,"keydown",function(e){13==e.keyCode&&(e.preventDefault(),t.remove())}),i.appendChild(this.rootElement),e.appendChild(i)}}remove(){this.bibliography.removeFilter(this.type),this.deflate()}}class ProfileBibliography extends Component{constructor(e,t){if(super(),this.container=document.querySelector(e),this.nameElement=document.querySelector(t),!this.container)throw"Invalid container selector";if(!this.nameElement)throw"Invalid name selector";this.name=this.nameElement.textContent.toLowerCase().trim(),this.isSimple=!0,this.sortVariable="date",this.citationList=new CitationList(this),this.citationPopup=new CitationPopup(this),this.itemTypes={},this.itemFields={},this.loadItemTypes(),this.loadItemFields()}inflate(){const e=document.createDocumentFragment();this.rootElement=document.createElement("div"),this.rootElement.id="bib",this.listElement=document.createElement("div"),this.listElement.id="bib-flex-content",this.rootElement.appendChild(this.listElement),e.appendChild(this.rootElement),this.container.appendChild(e),this.citationPopup.inflate(this.rootElement)}deflate(){this.citationList.deflate(),this.citationPopup.deflate(),parent.deflate()}loadCitations(){const e=this,t="https://api.zotero.org/users/10063140/items?q="+this.name+"&itemType=journalArticle&sort=date&direction=desc&limit=20&v=3";this.citationList.deflate(),this.citationList.inflatePlaceholders(this.listElement,20),this.httpGet(t,function(t){const i=JSON.parse(t.response);e.citationList.deflate(),e.citationList.inflate(e.listElement,i)})}loadItemTypes(){const e=this;this.httpGet("https://api.zotero.org/itemTypes",function(t){const i=JSON.parse(t.response);let n,o;for(n=0;n<i.length;n++)o=i[n],e.itemTypes[o.itemType]=o.localized})}loadItemFields(){const e=this;this.httpGet("https://api.zotero.org/itemFields",function(t){const i=JSON.parse(t.response);let n,o;for(n=0;n<i.length;n++)o=i[n],e.itemFields[o.field]=o.localized})}onSelection(e){this.citationPopup.openPopup(e,function(){e.titleElement.focus()})}}const bibliography=new ProfileBibliography("#bibliography","#employee-name");bibliography.inflate(),bibliography.loadCitations();